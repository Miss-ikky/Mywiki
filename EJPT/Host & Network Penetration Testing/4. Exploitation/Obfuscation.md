
## AV Evation with Shelter


















Defense Evation consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating/encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. 

AV Detection Methods
1. Signature based detection 
   An AV signature is a unique sequence of bytes that uniquely identified malware. As a result you will have to ensure that you obfuscated exploit or payload does not match any known signature in the AC database.
   
   We can bypass signature-based detection by modifying the malware byte sequence therefore changing the signature

2. Heuristic-based detection 
   Relies on rules or decisions to determine whether a binary is malicious. It also looks for specific patterns within the code or program calls
   
3. Behavior based detection 
   Relies on identifying malware by monitoring its behavior (used for newer strains of malware)

On-disk Evasion Techniques
- Obfuscation: Obfuscation refers to the process of concealing something important, valuable, critical. Obfuscation reorganizes code in order to make it harder to analyze or RE
- Encoding: Encoding data is a process involving changing data into a new format using a scheme. Encoding is a reversible process: data can be encoded to a new format and decoded to its original format
- Packing: Generate executable with new binary structure with a smaller size and therefore provides the payload with a new signature
- Crypters: Encrypts code or payloads and decrypts the encrypted code in memory. The decryption key/function is usually stored in a stub. (ransomeware only hackers have the key)


In-Memory Evasion Techniques
	- Focus on manipulation of memory and does not write files to disk
	- Injects payload into a process by leveraging various Windows APIs
	- Payload is then executed in memory in a separate thread. 

Shellter
www.shellterproject[.]com 

- `sudo apt-get install shellter -y `
	-wine is allows you to execute windows executables on a linux system
- to install 32-bit packages: s`udo dpkg --add-architecture i386`
- `sudo apt-get install wine32`
- `cd /usr/share/windows-resources/shellter `
- you can execute a exe file on linux with wine: `sudo wine shellter.exe `
- identify legitimate executable you can inject your executable in
	- copy file: vncviewer.exe 
	- create folder AVBypass
	- put the file vncviewer.exe in the folder. 
- launch shelter
	- A (auto)
	- PE target: (provide the path of the file you want to inject into)
	- enable stealth mode: Y 
	- payload: L (listed payload) 1 

- transfer file to target 
	- get to the directory where the malicious injected file is - set up simple python webserver 
- set up multi/handler in msfconsole 
	- set payload windows/meterpreter/reverse_tcp 
- 






















## Obfuscation with PowerShell code 